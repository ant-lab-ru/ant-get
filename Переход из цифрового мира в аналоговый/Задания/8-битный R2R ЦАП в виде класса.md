---
тема: Переход из цифрового мира в аналоговый
автор: Иван Юрьевич Потылицын
дата: 2025-09-29
задание: false
---

## Результат

- [ ] При помощи скрипта можно создавать на пине **OUT** блока **8-bit DAC** платы [[Печатная плата get-dac|get-dac]] аналоговое напряжение от 0.0 В до ~3.3 В
- [ ] При помощи того же скрипта можно создавать объект класса **R2R_DAC** и удобно пользоваться им в скриптах более высокого уровня

> [!EXAMPLE] Пример
> 
> **Вывод скрипта**
> 
> ![[r2r_dac.png]]
> 
> **Напряжение на мультиметре**
> 
> ![[r2r_dac-fluke.jpg]]

## Подготовка

1. В папке **get-dac** создайте файл **r2r_dac.py** и пишите в нём новый модуль

## Инструкция

1. Импортируйте модуль работы с GPIO
2. Объявите класс **R2R_DAC** и реализуйте его обязательный конструктор

```
class R2R_DAC:
    def __init__(self, gpio_bits, dynamic_range, verbose = False):
        self.gpio_bits = gpio_bits
        self.dynamic_range = dynamic_range
        self.verbose = verbose
        
        GPIO.setmode(GPIO.BCM)
        GPIO.setup(self.gpio_bits, GPIO.OUT, initial = 0)
```

3. Дополните класс «деструктором»

```
def deinit(self):
    GPIO.output(self.gpio_bits, 0)
    GPIO.cleanup()
```

> [!HINT] Совет
> 
> Найдите в конструкторе функции, которые мы добавляли в начало предыдущих скриптов.
> 
> Обратите внимание на то, что в деструкторе мы подаём на ЦАП число 0 и сбрасываем настройки GPIO. Вероятно этот метод стоит вызвать в блоке **finally**.

4. Добавьте в класс реализацию метода **set_number(self, number)**
5. Добавьте в класс реализацию метода **set_voltage(self, voltage)**

> [!NOTE] Примечание
> 
> Метод **set_number(self, number)** принимает на вход целое число и подаёт его двоичное представление на вход R2R-ЦАП.
> 
> Метод **set_voltage(self, voltage)** принимает на вход вещественное число и подаёт его двоичное представление на вход R2R-ЦАП при помощи метода **set_number(self, number)**.
> 
> Точно также, как в задании [[8-битный R2R ЦАП в виде скрипта]].

6. Реализуйте [[Основной охранник]] создаваемого модуля для работы R2R-ЦАП

```
if __name__ == "__main__":
    try:
        dac = R2R_DAC([16, 20, 21, 25, 26, 17, 27, 22], 3.183, True)
        
        while True:
            try:
                voltage = float(input("Введите напряжение в Вольтах: "))
                dac.set_voltage(voltage)

            except ValueError:
                print("Вы ввели не число. Попробуйте ещё раз\n")

    finally:
        dac.deinit()
```

> [!NOTE] Примечание
> 
> В основном охраннике мы создаём объект класса **R2R_DAC**, передавая нужные аргументы конструктору.
> 
> Далее мы делаем те же действия, что и в задании [[8-битный R2R ЦАП в виде скрипта]].
> 
> Разница в том, что в этом задании мы используем не обычные функции, а методы объекта класса.

## Завершение задания

1. Добавьте рабочий модуль **r2r_dac.py** в репозиторий **get**, сделайте коммит и отправьте изменения на сервер
