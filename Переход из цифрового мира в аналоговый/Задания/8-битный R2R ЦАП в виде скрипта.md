---
тема: Текстовый процессор
автор: Иван Юрьевич Потылицын
дата: 2025-09-05
задание: false
---

## Результат

- [ ] При помощи скрипта можно создавать на пине **OUT** блока **8-bit DAC** платы [[Печатная плата get-dac|get-dac]] аналоговое напряжение от 0.0 В до ~3.3 В
- [ ] Функции скрипта:
    - [ ] Читает ввод пользователя
    - [ ] Производит проверку введённого значения на число
    - [ ] Производит проврку на попадание введённого числа в динамический диапазон ЦАП

> [!EXAMPLE] Пример
> 
> **Вывод скрипта**
> 
> ![[8-bit-dac-manual.png]]
> 
> **Напряжение на мультиметре**
> 
> ![[8-bit-dac-manual-fluke.jpg]]

## Подготовка

1. Включите Raspberry Pi
2. Войдите в пользователя (ваша группа)
3. Создайте в домашней директории папку **Repositories**
4. Клонируйте ваш [[репозиторий]] **get** с сервера **[[GitHub]]** в папку **Repositories**
5. Запустите [[Visual Studio Code|VS Code]]
6. Откройте в [[Visual Studio Code|VS Code]] папку `~/Repositories/get`
7. Создайте в репозитории папку **get-dac**
8. В папке **get-dac** создайте файл **8-bit-dac-manual.py** и пишите в нём скрипт к этому заданию

## Инструкция

1. Импортируйте модуль работы с GPIO
2. Создайте переменную со списком GPIO-пинов, подключённых ко входам R2R-ЦАП в блоке **8-bit DAC**
3. Настройте эти пины, как выходы
4. Создайте переменную с динамическим диапазоном R2R-ЦАП (~3.3 В)
5. Объявите и реализуйте функцию **voltage_to_number(voltage)**

```
def voltage_to_number(voltage):
    if not (0.0 <= voltage <= dynamic_range):
        print(f"Напряжение выходит за динамический диапазон ЦАП (0.00 - {dynamic_range:.2f} В)")
        print("Устанавлниваем 0.0 В")
        return 0

    return int(voltage / dynamic_range * 255)
```

> [!NOTE] Примечание
> 
> Функция **voltage_to_number(voltage)** принимает на вход напряжение, которое вы хотите получить на выходе ЦАП.
> 
> Функция возвращает максимально близкое целое число от 0 до 255, соответствующее отношению задаваемого напряжения к динамическому диапазону ЦАП.
> 
> Перед возвратом целого числа функция проверят, что напряжение укладывается в динамический диапазон ЦАП. В противном случае функция возвращает 0.

6. Объявите и реализуйте функцию **number_to_dac(number)**

> [!NOTE] Примечание
> 
> Функция **number_to_dac(number)** принимает на вход целое число и подаёт его двоичное представление на вход R2R-ЦАП.

> [!HINT] Совет
> 
> Идеи для реализации этой функции стоит поискать в задании [[Двоичный счётчик]].

7. Дополните скрипт его рабочей частью

```
try:
    while True:
        try:
            voltage = float(input("Введите напряжение в Вольтах: "))
            number = voltage_to_number(voltage)
            number_to_dac(number)

        except ValueError:
            print("Вы ввели не число. Попробуйте ещё раз\n")

finally:
    GPIO.output(dac_bits, 0)
    GPIO.cleanup()
```

> [!NOTE] Примечания
> 
> - В основном блоке **try** скрипт дожидается ввода напряжения от пользователя
> - Блок **finally** исполняется перед любым завершением скрипта (например, **Ctrl + C**)
> - В блоке **finally** мы подаём на вход ЦАП число 0 и сбрасываем настройки GPIO
> - В бесконечном цикле скрипт:
>     - Просит пользователя ввести напряжение
>     - Пытается привести введённый текст к вещественному числу
>     - Сообщает пользователю об ошибке, если попытка приведения текста к числу не удаётся
>     - Переводит аналоговое напряжение в цифровое число
>     - Подаёт число на вход R2R-ЦАП

## Завершение задания

1. Добавьте скрипт **8-bit-dac-manual.py** в репозиторий **get**, сделайте коммит и отправьте изменения на сервер
